{% extends "layout/app_base.html" %}

{% block title %}Collateral Dynamic{% endblock %}

{% block extra_head %}
  {{ block.super }}
  <style>
    .collateral-dynamic{
      --cd-panel:#ffffff;
      --cd-muted:#6b7280;
      --cd-accent:#0a6af0;
      --cd-line:#e5edf6;
      --cd-ink:#1f2937;
      --cd-shadow:0 4px 12px rgba(15,23,42,.04);
    }
    .collateral-dynamic .section-tabs{
      display:flex;
      gap:12px;
      margin-top:12px;
      font-size:12px;
      text-transform:uppercase;
    }
    .collateral-dynamic .section-tab{
      padding:6px 14px;
      border-radius:999px;
      border:1px solid transparent;
      background:var(--cd-panel);
      color:var(--cd-muted);
      font-weight:500;
      text-decoration:none;
    }
    .collateral-dynamic .section-tab.active{
      color:var(--cd-accent);
      border-color:var(--cd-line);
      box-shadow:0 8px 16px rgba(15,23,42,.08);
    }
    .collateral-dynamic .section-content{
      margin-top:18px;
    }
    .collateral-dynamic .layout{
      display:grid;
      grid-template-columns:240px 1fr;
      gap:20px;
    }
    .collateral-dynamic .menu-card{
      background:#fff;
      border-radius:18px;
      padding:16px;
      box-shadow:0 12px 30px rgba(15,23,42,.1);
    }
    .collateral-dynamic .menu-card .menu-title{
      font-size:12px;
      font-weight:600;
      color:#4b5563;
      margin-bottom:16px;
      letter-spacing:.2px;
    }
    .collateral-dynamic .menu-item{
      width:100%;
      border:none;
      background:transparent;
      padding:10px 12px;
      border-radius:12px;
      display:flex;
      align-items:center;
      gap:12px;
      font-size:14px;
      color:#475569;
      cursor:pointer;
      text-decoration:none;
      transition:background .2s ease,color .2s ease;
    }
    .collateral-dynamic .menu-item.active{
      background:#eef2ff;
      color:#0b2a66;
      font-weight:600;
    }
    .collateral-dynamic .menu-icon{
      width:24px;
      height:24px;
      border-radius:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#eef2ff;
      color:#0b2a66;
      font-size:12px;
    }
    .collateral-dynamic .menu-group-label{
      margin-top:18px;
      display:flex;
      align-items:center;
      gap:10px;
      font-size:14px;
      font-weight:600;
      color:#0b2a66;
    }
    .collateral-dynamic .inventory-sublist{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:12px;
      padding-left:14px;
    }
    .collateral-dynamic .inventory-subitem{
      border-radius:12px;
      padding:10px 16px;
      background:#f5f7fb;
      color:#475569;
      font-weight:600;
      text-decoration:none;
      transition:background .2s ease;
      font-size:13px;
    }
    .collateral-dynamic .inventory-subitem.active{
      background:#0b2a66;
      color:#fff;
      box-shadow:0 6px 12px rgba(15,23,42,.2);
    }
    .collateral-dynamic .panel{
      background:var(--cd-panel);
      border:1px solid var(--cd-line);
      border-radius:14px;
      padding:18px;
      box-shadow:var(--cd-shadow);
      margin-bottom:18px;
    }
    .collateral-dynamic .page{
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    .collateral-dynamic .card{
      background:#fff;
      border:1px solid var(--cd-line);
      border-radius:12px;
      box-shadow:var(--cd-shadow);
      padding:12px;
    }
    .collateral-dynamic .cardHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding-bottom:6px;
      border-bottom:1px solid #eef1f7;
    }
    .collateral-dynamic .hleft{
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:600;
      font-size:12px;
      color:#1f2a37;
    }
    .collateral-dynamic .spark{
      width:14px;
      height:14px;
      color:var(--cd-accent);
    }
    .collateral-dynamic .snapshotText{
      font-size:12px;
      color:#475569;
      line-height:1.5;
      padding:8px 0 0 2px;
    }
    .collateral-dynamic .grid2{
      display:grid;
      grid-template-columns:260px 1fr;
      gap:12px;
    }
    .collateral-dynamic .mix-trend-card{
      grid-column:1 / -1;
    }
    .collateral-dynamic .smallTitle{
      font-size:10px;
      font-weight:600;
      color:#4b5563;
      padding-bottom:8px;
    }
    .collateral-dynamic .donutWrap{
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:center;
      padding:10px 0 0 0;
    }
    .collateral-dynamic .donutCard{
      position:relative;
      width:150px;
      height:150px;
    }
    .collateral-dynamic .donutBox{
      position:relative;
      width:150px;
      height:150px;
      display:grid;
      place-items:center;
    }
    .collateral-dynamic .donutCenter{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      font-weight:800;
      font-size:20px;
    }
    .collateral-dynamic .bars{
      width:100%;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .collateral-dynamic .barRow{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .collateral-dynamic .barLine{
      height:20px;
      border-radius:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:0 10px;
      color:#ffffff;
      font-weight:600;
      font-size:10px;
      letter-spacing:.2px;
    }
    .collateral-dynamic .barLine span{display:flex;align-items:center;gap:4px}
    .collateral-dynamic .barLine .dot{display:none}
    .collateral-dynamic .barLine.navy{background:#116BFD;}
    .collateral-dynamic .barLine.mid{background:#0753B2;}
    .collateral-dynamic .barLine.bright{background:#CADFEF;color:#1f2a37;}

    .collateral-dynamic .legend{
      display:flex;
      gap:12px;
      align-items:center;
      font-size:10px;
      color:#6b7280;
    }
    .collateral-dynamic .legItem{
      display:flex;
      gap:6px;
      align-items:center;
      text-transform:uppercase;
      font-size:9px;
      letter-spacing:.3px;
    }
    .collateral-dynamic .sw{
      width:10px;
      height:10px;
      border-radius:2px;
      display:inline-block;
    }
    .collateral-dynamic .sw.navy{background:#116BFD}
    .collateral-dynamic .sw.mid{background:#0753B2}
    .collateral-dynamic .sw.bright{background:#CADFEF}
    .collateral-dynamic .chartPad{
      padding:12px 6px 4px 6px;
      position:relative;
    }
    .collateral-dynamic .chart-tooltip{
      position:absolute;
      background:#111827;
      color:#fff;
      padding:6px 10px;
      border-radius:8px;
      font-size:11px;
      letter-spacing:.02em;
      box-shadow:0 10px 24px rgba(15,23,42,.3);
      pointer-events:none;
      transform:translate(-50%,-110%);
      opacity:0;
      transition:opacity .15s ease;
      white-space:nowrap;
      z-index:10;
    }
    .collateral-dynamic .chart-tooltip strong{
      display:block;
      font-size:10px;
      font-weight:600;
      margin-bottom:2px;
    }
    .collateral-dynamic .chart-tooltip span{
      font-size:12px;
      font-weight:500;
    }
    .collateral-dynamic .chart-tooltip.is-visible{
      opacity:1;
    }
    .collateral-dynamic .svgBox{
      width:100%;
      height:100%;
      border-radius:10px;
      background:#fff;
    }
    .collateral-dynamic .axisText{
      font-size:8px;
      fill:#9aa7b8;
    }
    .collateral-dynamic .gridLine{
      stroke:#eef2f7;
      stroke-width:1;
    }
    .collateral-dynamic .tableWrap{
      padding:8px 4px 8px 4px;
    }
    .collateral-dynamic table{
      width:100%;
      border-collapse:collapse;
      font-size:11px;
      color:#374151;
    }
    .collateral-dynamic thead th{
      font-weight:600;
      color:#6b7280;
      padding:8px 6px;
      border-bottom:1px solid #f0f4fa;
      text-align:left;
    }
    .collateral-dynamic tbody td{
      padding:10px 6px;
      border-bottom:1px solid #f0f4fa;
      text-align:left;
    }
    .collateral-dynamic tbody tr:last-child td{
      border-bottom:none;
    }
    .collateral-dynamic .recovery-table th,
    .collateral-dynamic .recovery-table td{
      text-align:center;
    }
    .collateral-dynamic .recovery-table{
      table-layout:fixed;
    }
    .collateral-dynamic .recovery-table col.col-label{
      width:18%;
    }
    .collateral-dynamic .recovery-table col.col-num{
      width:11.7%;
    }
    .collateral-dynamic .recovery-table th:first-child,
    .collateral-dynamic .recovery-table td:first-child{
      text-align:left;
      width:140px;
    }
    .collateral-dynamic .recovery-table thead tr.tblGroup th{
      text-align:center;
      font-weight:700;
      border-bottom:none;
      padding-bottom:2px;
    }
    .collateral-dynamic .recovery-table thead tr.tblGroup th:first-child{
      text-align:left;
    }
    .collateral-dynamic .recovery-table thead tr.tblSub th{
      font-size:10px;
      color:#94a3b8;
      font-weight:600;
      letter-spacing:.2px;
      padding-top:2px;
    }
    .collateral-dynamic .mt12{
      margin-top:12px;
    }
    .collateral-dynamic .value-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
      gap:10px;
      margin-top:12px;
    }
    .collateral-dynamic .value-card{
      border:1px solid #f0f4fa;
      border-radius:10px;
      padding:12px;
      background:#f8fafc;
    }
    .collateral-dynamic .value-card .label{
      font-size:10px;
      color:#6b7280;
      text-transform:uppercase;
      letter-spacing:.3px;
    }
    .collateral-dynamic .value-card .value{
      font-size:18px;
      font-weight:700;
      margin-top:4px;
      color:#111827;
    }
    .collateral-dynamic .value-card .trend{
      font-size:11px;
      margin-top:4px;
      color:#16a34a;
    }
    .collateral-dynamic .value-card .trend.down{
      color:#dc2626;
    }
    .collateral-dynamic .table-card{
      border:1px solid #e5e7eb;
      border-radius:12px;
      overflow:hidden;
      margin-top:12px;
    }
    .collateral-dynamic .stats-row{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
      gap:16px;
      margin-bottom:12px;
      margin-top:12px;
    }
    .collateral-dynamic .chart-card header{
      font-size:12px;
      font-weight:600;
      display:flex;
      justify-content:space-between;
      margin-bottom:8px;
    }
    .collateral-dynamic .panel-header{
      display:flex;align-items:center;gap:10px;
      font-size:14px;font-weight:600;
      margin-bottom:14px;
      color:var(--cd-ink);
    }
    .collateral-dynamic .panel-header svg{width:16px;height:16px;stroke:var(--cd-accent)}
    .collateral-dynamic .snapshot-text{
      font-size:13px;
      color:#475569;
      line-height:1.6;
      margin-bottom:16px;
    }
    .collateral-dynamic .snapshot-grid{
      display:grid;
      grid-template-columns:220px 1fr;
      gap:20px;
    }
    .collateral-dynamic .donut-card{
      border:1px solid var(--cd-line);
      border-radius:12px;
      padding:12px;
      text-align:center;
    }
    .collateral-dynamic .donut-card .total{
      font-size:24px;font-weight:700;margin:8px 0;
    }
    .collateral-dynamic .donut-card .labels{
      margin-top:12px;
      text-align:left;
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size:12px;
      color:#475569;
    }
    .collateral-dynamic .legend-dot{
      width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:6px;
    }
    .collateral-dynamic .chart-card{
      border:1px solid var(--cd-line);
      border-radius:12px;
      padding:12px;
    }
    .collateral-dynamic .chart-card header{
      font-size:13px;
      font-weight:600;
      margin-bottom:8px;
      display:flex;
      justify-content:space-between;
      color:var(--cd-ink);
    }
    .collateral-dynamic .value-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(150px,1fr));
      gap:12px;
      margin-bottom:12px;
    }
    .collateral-dynamic .value-card{
      border:1px solid var(--cd-line);
      border-radius:10px;
      padding:12px;
      background:#fafcff;
    }
    .collateral-dynamic .value-card .label{
      font-size:11px;
      color:var(--cd-muted);
      text-transform:uppercase;
      letter-spacing:.3px;
    }
    .collateral-dynamic .value-card .value{
      font-size:18px;
      font-weight:600;
      margin-top:6px;
      color:var(--cd-ink);
    }
    .collateral-dynamic .value-card .trend{
      font-size:12px;
      margin-top:4px;
      color:#16a34a;
    }
    .collateral-dynamic .value-card .trend.down{color:#dc2626}
    .collateral-dynamic .table-card{
      border:1px solid var(--cd-line);
      border-radius:12px;
      overflow:hidden;
    }
    .collateral-dynamic .stats-row{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
      gap:16px;
    }
    .collateral-dynamic table{
      width:100%;
      border-collapse:collapse;
      font-size:12px;
      color:#475569;
    }
    .collateral-dynamic th,
    .collateral-dynamic td{
      padding:10px 8px;
      border-bottom:1px solid var(--cd-line);
      text-align:left;
    }
    .collateral-dynamic th{
      background:#f9fbff;
      color:#6b7280;
      font-weight:600;
    }
    .collateral-dynamic tbody tr:last-child td{border-bottom:none}
    .collateral-dynamic .placeholder-panel{
      min-height:280px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:flex-start;
      gap:8px;
      color:#475569;
    }
    .collateral-dynamic .placeholder-panel p{
      margin:0;
      font-size:13px;
      line-height:1.5;
      color:#475569;
    }
  </style>
{% endblock %}

{% block page_content %}
  <div class="collateral-dynamic">
    <div class="layout">
      {% include "collateral_dynamic/inventory/_menu.html" with inventory_tab=inventory_tab|default:"summary" active_section=active_section %}
      <div class="page">
        {% if active_section == 'overview' %}
          {% include "collateral_dynamic/inventory/summary.html" %}
        {% elif active_section == 'accounts_receivable' %}
          <div class="panel placeholder-panel">
            <div class="panel-header">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4h16v16H4z"/>
                <path d="M4 10h16"/>
                <path d="M10 4v16"/>
              </svg>
              Accounts Receivable
            </div>
            <p>
              Accounts Receivable dynamics will appear here with total balance, aging buckets, and past due trends.
            </p>
          </div>
        {% else %}
          {% if inventory_tab == 'finished_goods' %}
            {% include "collateral_dynamic/inventory/finished_goals.html" %}
          {% elif inventory_tab == 'raw_materials' %}
            {% include "collateral_dynamic/inventory/raw_materials.html" %}
          {% elif inventory_tab == 'work_in_progress' %}
            {% include "collateral_dynamic/inventory/work_in_progress.html" %}
          {% elif inventory_tab == 'liquidation_model' %}
            {% include "collateral_dynamic/inventory/liquidation_model.html" %}
          {% elif inventory_tab == 'other_collateral' %}
            {% include "collateral_dynamic/inventory/other_collateral.html" %}
          {% else %}
            {% include "collateral_dynamic/inventory/summary.html" %}
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script src="{% static 'js/inventory_summary.js' %}"></script>
{% endblock %}
