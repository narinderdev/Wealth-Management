{% extends "layout/app_base.html" %}
{% load static %}

{% block title %}CORA Dashboard{% endblock %}

{% block page_content %}
<head>
   
    <link rel="stylesheet" href="{% static 'css/summary.css' %}">
</head>
<div class="pill">Borrower Overview</div>  
  <div class="grid">
    <!-- Left: Borrower -->
     <div class="card borrower">      
            <div class="kv">
              <img src="{% static 'images/company_logo.svg' %}" 
              alt="Company Logo"
              class="company-logo" />

              <div>Company Name</div>
              <div class="v">{{ borrower_summary.company_name }}</div>
            </div>
            <div class="kv">
              <img src="{% static 'images/company_idicon.svg' %}" 
              alt="Company ID"
              class="company-id" />
              <div>Company ID</div>
              <div class="v">{{ borrower_summary.company_id }}</div>
            </div>
            <div class="kv">
              <img src="{% static 'images/industory_icon.svg' %}" 
              alt="Industry Icon"
              class="industry-icon" />

              <div>Industry</div>
              <div class="v">{{ borrower_summary.industry }}</div>
            </div>
            <div class="kv">
              <img src="{% static 'images/naics_icon.svg' %}" 
              alt="NAICS Icon"
              class="naics-icon" />
              <div>NAICS</div>
              <div class="v">{{ borrower_summary.primary_naics }}</div>
            </div>
            <div class="kv">
              <img src="{% static 'images/website_icon.svg' %}" 
              alt="Website Icon"
              class="website-icon" />
              <div>Website</div>
              <div class="v link">
                {% if borrower_summary.website != "—" and borrower_summary.website_url %}
                <a href="{{ borrower_summary.website_url }}" target="_blank" rel="noreferrer">
                  {{ borrower_summary.website }}
                </a>
                {% else %}
                  {{ borrower_summary.website }}
                {% endif %}
              </div>
            </div>

            <div class="divider"></div>

            <div class="kv">
              <img src="{% static 'images/primary_contant_icon.svg' %}" 
              alt="Primary Icon"
              class="primary_contact" />
              <div>Primary Contact</div>
              <div class="v">{{ borrower_summary.primary_contact }}</div>
            </div>
            <div class="kv">
              <img src="{% static 'images/contact_no.svg' %}" 
              alt="contact Icon"
              class="contact-icon" />
              <div>Contact Number</div>
              <div class="v">{{ borrower_summary.primary_contact_phone }}</div>
            </div>
            <div class="kv">
                      <img src="{% static 'images/email.svg' %}" 
              alt="Email Icon"
              class="email-icon" />
              <div>Contact Email</div>
              <div class="v">
                {% if borrower_summary.primary_contact_email != "—" %}
                <a href="mailto:{{ borrower_summary.primary_contact_email }}">
                  {{ borrower_summary.primary_contact_email }}
                </a>
                {% else %}
                  {{ borrower_summary.primary_contact_email }}
                {% endif %}
              </div>
            </div>

            <div class="divider"></div>

            <div class="kv">
                      <img src="{% static 'images/update_interval.svg' %}" 
              alt="Update Interval Icon"
              class="update-interval-icon" />

              <div>Project Renewal</div>
              <div class="v">{{ borrower_summary.update_interval }}</div>
            </div>
            <div class="kv">
              <img src="{% static 'images/current_update.svg' %}" 
              alt="Current Update Icon"
              class="current-update-icon" />
              <div>Current Update</div>
              <div class="v">{{ borrower_summary.current_update }}</div>
            </div>
            <div class="kv">
              <img src="{% static 'images/previous_update.svg' %}" 
              alt="Previous Update Icon"
              class="previous-update-icon" />
              <div>Previous Update</div>
              <div class="v">{{ borrower_summary.previous_update }}</div>
            </div>
            <div class="kv">
              <img src="{% static 'images/next_update.svg' %}" 
              alt="Next Update Icon"
              class="next-update-icon" />
              <div>Next Update</div>
              <div class="v">{{ borrower_summary.next_update }}</div>
            </div>
      </div>        
      
    <div style=margin:10px;>
      
      <div>
        <!-- Right: Borrowing base insight -->
    <div class="insight-card">
      <div class="insight-card__header">
        <div class="insight-head-left">
          <img src="{% static 'images/borrowing_icon.svg' %}" 
            alt="Current Update Icon"
            class="current-update-icon" />
          <h2>Borrowing Base Insight</h2>
        </div>
        
      </div>

      <div class="insight-grid-wrap">
        <div class="insight-meta-grid">
          <div class="meta-card meta-card--blue">
            <div>
              <div class="meta-label">Net Collateral</div>
              <div class="meta-value">{{ insights.net.amount }}</div>
              {% if insights.net.delta %}
                <div class="meta-delta {{ insights.net.delta.class }}">{{ insights.net.delta.symbol }} {{ insights.net.delta.value }}</div>
              {% else %}
                <div class="meta-delta">—</div>
              {% endif %}
            </div>
            <img src="{% static 'images/net_collateral_icon.svg' %}" 
            alt="Net Collateral Icon"
            class="net-collateral-icon" />
          
          </div>
          <div class="meta-card meta-card--purple">
            <div>
              <div class="meta-label">Outstanding Balance</div>
              <div class="meta-value">{{ insights.outstanding.amount }}</div>
              {% if insights.outstanding.delta %}
                <div class="meta-delta {{ insights.outstanding.delta.class }}">{{ insights.outstanding.delta.symbol }} {{ insights.outstanding.delta.value }}</div>
              {% else %}
                <div class="meta-delta">—</div>
              {% endif %}
            </div>
            <img src="{% static 'images/outstanding_balance_icon.svg' %}" 
            alt="Outstanding Balance Icon"
            class="outstanding-balance-icon" />
          </div>
          <div class="meta-card meta-card--green">
            <div>
              <div class="meta-label">Availability</div>
              <div class="meta-value">{{ insights.availability.amount }}</div>
              {% if insights.availability.delta %}
                <div class="meta-delta {{ insights.availability.delta.class }}">{{ insights.availability.delta.symbol }} {{ insights.availability.delta.value }}</div>
              {% else %}
                <div class="meta-delta">—</div>
              {% endif %}
            </div>
            <img src="{% static 'images/availability_icon.svg' %}" 
            alt="Availability Icon"
            class="availability-icon" />
          </div>
        </div>

        <div class="insight-chart-grid">
          <div class="chart-card chart-card--blue">
          
          <div class="panel-chart">
            <div class="chart-tooltip" aria-hidden="true"></div>
            <svg viewBox="0 0 220 140" preserveAspectRatio="none">
              <rect class="panel-bg" x="0" y="0" width="220" height="140" rx="0"></rect>
              <g class="panel-grid">
                {% for tick in net_chart.y_ticks %}
                  <line x1="{{ net_chart.grid.left }}" y1="{{ tick.y }}" x2="{{ net_chart.grid.right }}" y2="{{ tick.y }}"></line>
                {% endfor %}
                {% for x in net_chart.x_grid %}
                  <line x1="{{ x }}" y1="{{ net_chart.grid.top }}" x2="{{ x }}" y2="{{ net_chart.grid.bottom }}"></line>
                {% endfor %}
              </g>
              <polyline class="panel-line panel-line--blue" points="{{ net_chart.points }}"/>
              <g class="panel-dots">
                {% for point in net_chart.points_list %}
                <circle cx="{{ point.x }}" cy="{{ point.y }}" r="2.2"
                  data-label="{{ point.label }}"
                  data-value="{{ point.value }}"/>
                {% endfor %}
              </g>
            <g class="panel-axis">
              {% for tick in net_chart.y_ticks %}
                <text x="{{ net_chart.label_x }}" y="{{ tick.y|add:3 }}" text-anchor="start">{{ tick.label }}</text>
              {% endfor %}
              {% for label in net_chart.x_labels %}
                <text x="{{ label.x }}" y="{{ net_chart.label_y }}" text-anchor="middle">{{ label.text }}</text>
              {% endfor %}
              </g>
            </svg>
          </div>
          </div>

          <div class="chart-card chart-card--purple">
          <div class="panel-chart">
            <div class="chart-tooltip" aria-hidden="true"></div>
            <svg viewBox="0 0 220 140" preserveAspectRatio="none">
              <rect class="panel-bg" x="0" y="0" width="220" height="140" rx="0"></rect>
              <g class="panel-grid">
                {% for tick in outstanding_chart.y_ticks %}
                  <line x1="{{ outstanding_chart.grid.left }}" y1="{{ tick.y }}" x2="{{ outstanding_chart.grid.right }}" y2="{{ tick.y }}"></line>
                {% endfor %}
                {% for x in outstanding_chart.x_grid %}
                  <line x1="{{ x }}" y1="{{ outstanding_chart.grid.top }}" x2="{{ x }}" y2="{{ outstanding_chart.grid.bottom }}"></line>
                {% endfor %}
              </g>
              <polyline class="panel-line panel-line--purple" points="{{ outstanding_chart.points }}"/>
              <g class="panel-dots">
                {% for point in outstanding_chart.points_list %}
                <circle cx="{{ point.x }}" cy="{{ point.y }}" r="2.2"
                  data-label="{{ point.label }}"
                  data-value="{{ point.value }}"/>
                {% endfor %}
              </g>
            <g class="panel-axis">
              {% for tick in outstanding_chart.y_ticks %}
                <text x="{{ outstanding_chart.label_x }}" y="{{ tick.y|add:3 }}" text-anchor="start">{{ tick.label }}</text>
              {% endfor %}
              {% for label in outstanding_chart.x_labels %}
                <text x="{{ label.x }}" y="{{ outstanding_chart.label_y }}" text-anchor="middle">{{ label.text }}</text>
              {% endfor %}
              </g>
            </svg>
          </div>
          </div>

          <div class="chart-card chart-card--green">
          <div class="panel-chart">
            <div class="chart-tooltip" aria-hidden="true"></div>
            <svg viewBox="0 0 220 140" preserveAspectRatio="none">
              <rect class="panel-bg" x="0" y="0" width="220" height="140" rx="0"></rect>
              <g class="panel-grid">
                {% for tick in availability_chart.y_ticks %}
                  <line x1="{{ availability_chart.grid.left }}" y1="{{ tick.y }}" x2="{{ availability_chart.grid.right }}" y2="{{ tick.y }}"></line>
                {% endfor %}
                {% for x in availability_chart.x_grid %}
                  <line x1="{{ x }}" y1="{{ availability_chart.grid.top }}" x2="{{ x }}" y2="{{ availability_chart.grid.bottom }}"></line>
                {% endfor %}
              </g>
              <polyline class="panel-line panel-line--green" points="{{ availability_chart.points }}"/>
              <g class="panel-dots">
                {% for point in availability_chart.points_list %}
                <circle cx="{{ point.x }}" cy="{{ point.y }}" r="2.2"
                  data-label="{{ point.label }}"
                  data-value="{{ point.value }}"/>
                {% endfor %}
              </g>
              <g class="panel-axis">
                {% for tick in availability_chart.y_ticks %}
                  <text x="{{ availability_chart.label_x }}" y="{{ tick.y|add:3 }}" text-anchor="start">{{ tick.label }}</text>
                {% endfor %}
                {% for label in availability_chart.x_labels %}
                  <text x="{{ label.x }}" y="{{ availability_chart.label_y }}" text-anchor="middle">{{ label.text }}</text>
                {% endfor %}
              </g>
            </svg>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="table-card table-card--collateral2">
        <div class="cc-head">
          <div class="cc-head-left">
             <img src="{% static 'images/borrowing_icon.svg' %}" 
          alt="Current Update Icon"
          class="current-update-icon" />
            <span>Collateral Composition</span>
          </div>
        </div>

        <div class="cc-wrap">
          <table class="cc-table">
            <thead>
              <tr>
                <th></th>
                <th>Beginning Collateral</th>
                <th>Ineligibles</th>
                <th>Eligible Collateral</th>
                <th>NOLV %</th>
                <th>Dilution Rate</th>
                <th>Advanced Rate</th>
                <th>Rate Limit</th>
                <th>Utilized Rate</th>
                <th>Pre-Reserve Collateral</th>
                <th>Reserves</th>
                <th>Net Collateral</th>
                <th class="cc-ctl"></th>
              </tr>
            </thead>

            <tbody>
              {% if collateral_tree %}
                {% include "partials/collateral_rows.html" with nodes=collateral_tree level=0 parent_id="" %}
              {% else %}
                <tr><td colspan="13" class="cc-empty">Collateral data unavailable</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
  </div>
  
           
      </div>
      <div class="risk">
        <div class="risk-title">Risk Profile</div>
        <div class="risk-score">
          <div class="risk-circle" data-tooltip="{{ risk_profile_detail|default:'Risk detail unavailable' }}">
            <span>{{ risk_profile_value|default:"3.1" }}</span>
          </div>
        </div>
        <div class="risk-scale">
            <div class="risk-bar">
              <span class="risk-marker" style="--pos:{{ risk_profile_position }}%"></span>
            </div>
            <div class="risk-labels">
              <span>Low</span>
              <span>Mild</span>
              <span>Average</span>
              <span>Elevated</span>
              <span>High</span>
            </div>
          </div>
        <div class="risk-tooltip" aria-hidden="true"></div>
        <div class="risk-metrics">
          {% for metric in risk_metrics %}
          <div class="risk-row">
            <span>{{ metric.label }}</span>
            <span class="risk-change {{ metric.direction }}" style="--risk-color: {{ metric.color }};">
              {% if metric.direction == 'up' %}
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 19V5"/><path d="M5 12l7-7 7 7"/>
              </svg>
              {% else %}
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14"/><path d="M19 12l-7 7-7-7"/>
              </svg>
              {% endif %}
              {{ metric.detail }}
            </span>
          </div>
          {% endfor %}
        </div>
      </div>
      </div>

    
{% endblock %}

{% block extra_scripts %}
  <script src="{% static 'js/summary.js' %}"></script>
{% endblock %}
